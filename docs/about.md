[← Home](index.md) [Quickstart →](quickstart.md) [Features →](features.md) [API →](api_reference.md)

# What is Gripper

Gripper is a browser automation toolbox that operates in a browser window under its control,
using the Chrome Devtools Protocol (CDP).

## Use cases

The main use case is 

## Requirements

Gripper is designed around the following key requirements:

- Scraping SPAs with service workers actively rebuilding the DOM.
- Reliable, long-running and low-upkeep remote deployment.
- Running parallel web-scraping tasks in independent browser windows.
- Reliable JavaScript evaluation in iFrames.

# Principles

## Transparency

Gripper exposes its resources, effectively passing ownership to the user. This includes the browser OS `Process` handle, the root `ChromeSession` instance or full raw access to the browser CDP API endpoint.

The rule of thumb is that it should be possible to build Gripper on top of itself without too much hacking.

## Low level access

Compared to other popular automation frameworks, Gripper makes the CDP layer completely visible and accessible rather than masking its presence behind own adapters.

While Gripper does wrap the CDP with own code, the types, commands and events are always a 1-1 mapping. In fact, they're autogenerated from the [specs](https://github.com/ChromeDevTools/devtools-protocol/tree/master/json).

# Features

The features related to deployment are written against the standard .NET 6 API. the bare CDP

## Service oriented design

Gripper provides extensions for adding itself into an `IServiceCollection`.

Each time the client code resolves the transient `IWebClient` service, a fresh browser window is launched and bound.

This enables performing paralellizable tasks (connecting to multiple sibling WebSocket endpoints, obtaining multiple valid session tokens, polling multiple sibling pages...) from a single C&C thread.

## Automated browser launch and disposal

The `WebClientSettings` configuration class facilitates declarative management of browser instances lifetime.

The `Runtime.IChildProcessTracker` service prevents stale browser windows and memory leaks, enabling a long-running, no-downtime deployment.

## Configurability

The default behaviour is highly configurable, including:

- Specifying the user data directory for each browser window.
- Purging selected data from existing user data directory before launching.
- Binding to an existing browser window, as opposed to launching own one.
- Passing custom startup parameters new browser windows.

## Full CDP API access

To provide full access to the Chrome Devtools Protocol API, Gripper includes its own build of the [chrome-dev-tools-runtime](https://github.com/BaristaLabs/chrome-dev-tools-runtime), exposing a strongly-typed wrapper of the CDP types, commands and events.

## CDP forward compatibility

In addition to the strongly-typed API, Gripper provides overrides for literal invocation of CDP commands, returning the response as raw `JToken`. This enables using an older build of Gripper against Chrome with newer CDP API version.

## Forward Chrome compatibility

Gripper aims to work reliably with [Stable](https://chromereleases.googleblog.com/) Chrome on Windows/Windows Server, including robust handling of automatic Chrome updates.

To make any breaking impact of automatic Chrome update on a running Gripper very unlikely, the built-in CDP wrapper targets a version of the protocol, not the browser.

The only time a running Gripper deployment needs rebuild is when the browser updates during runtime *and* the new version's CDP API introduces breaking changes to a signature that the application *actively uses*.

## Target discovery and attachment

If the browser is launched with site isolation disabled (as it is by default), Gripper automatically discovers and attaches to new targets as they are opened by Gripper itself, by a background Service Worker or even by manual interaction. 

Therefore, on enabled domains, events start flowing automatically from new targets to the existing subscribers. Similarly, enabling a domain works on all attached targets.

## Execution context mapping

Gripper provides access to the browsing contexts of the page and maps each to its corresponding execution context.

Gripper tracks the lifetime of execution contexts' lifetime. Furthermore, Gripper automatically binds present browsing contexts to their respective execution contexts.

This enables evaluating custom JavaScript on the `Runtime` domain and accessing the [browser protocol CDP domains](https://github.com/ChromeDevTools/devtools-protocol/blob/master/json/browser_protocol.json) such as `DOM` and `Network` simultaneously.

## Smart waiting

The way an SPA bootstraps often depends on deployment-related factors like zone (varying round-trips to iFrames) or hardware.

Gripper provides a configurable `IWebClient.WaitUntilFramesLoadedAsync()` method that polls for changes in the frame tree and waits until all frames have been loaded and no new iFrames have started loading for a period of time.

Blocking until the scraping routine is safe to continue avoids those hard-to-catch, seemingly random errors like clicking stale elements or dereferencing destroyed execution contexts.

## Soon™

- Discovery and attachment of isolated targets (site-per-process, IsolateOrigins turned on).
- Forward compatibility for CDP events (relaying unknown events raw).
- Passing custom parameters to new browser windows programmatically, adding to the ability of each instance to alter its fingerprint.

# Features

Please see the [tests](https://github.com/tomaskrupka/Gripper/tree/main/test/Gripper.Test) for the current state.

## Implemented features

- CDP tunnelling (method calls and events).
- Automatic target (iFrame) binding.
- 1-1 mapping of a Gripper interface and a DOM element.
- 1-1-1 mapping of a Gripper interface, an iFrame and its corresponding JavaScript execution context.
- Target detection after the `Page.frameNavigated`, `Page.frameAttached` and `Page.frameStoppedLoading` events.



- `fetch()` injection.
- Pausing script execution in specific contexts.
- API to wait for an SPA that's building up to settle.

# Deployment
Gripper aims to support as many <OS, Browser> combinations as possible.
The basic dependencies are a .NET 6 Runtime and an installation of a browser that supports remote control over the CDP.

Below is a list of tested configurations:

Soon™
